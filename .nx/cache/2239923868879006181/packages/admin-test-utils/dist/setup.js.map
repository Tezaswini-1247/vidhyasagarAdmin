{"version":3,"file":"setup.js","sources":["../src/setup.ts"],"sourcesContent":["import { format } from 'util';\r\nimport { ResizeObserver } from '@juggle/resize-observer';\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * IntersectionObserver\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\nconst mockIntersectionObserver = jest.fn();\r\nmockIntersectionObserver.mockReturnValue({\r\n  observe: () => null,\r\n  unobserve: () => null,\r\n  disconnect: () => null,\r\n});\r\nwindow.IntersectionObserver = mockIntersectionObserver;\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * ResizeObserver\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\nwindow.ResizeObserver = ResizeObserver;\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * requestIdleCallback\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\ntype SetTimeout = typeof window.setTimeout;\r\n\r\nwindow.setImmediate =\r\n  window.setImmediate ||\r\n  ((fn: Parameters<SetTimeout>[0], ...args: any[]) => window.setTimeout(fn, 0, ...args));\r\n\r\nwindow.clearImmediate = window.clearImmediate || window.clearTimeout;\r\n\r\n// @ts-expect-error – mocking for testing\r\nwindow.requestIdleCallback = setImmediate;\r\n// @ts-expect-error – mocking for testing\r\nwindow.cancelIdleCallback = clearImmediate;\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * ResizeObserver\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\n/**\r\n * If there's a prop type error then we want to throw an\r\n * error so that the test fails.\r\n *\r\n * In the CI we fail the entire process if anything is logged to the console.\r\n * This is to stop pollution, you shouldn't need to log _anything_ to the console\r\n * for tests.\r\n */\r\nwindow.console = {\r\n  ...window.console,\r\n  warn(...args: any[]) {\r\n    throw new Error(format(...args));\r\n  },\r\n  error(...args: any[]) {\r\n    const message = format(...args);\r\n\r\n    if (/(Invalid prop|Failed prop type)/gi.test(message)) {\r\n      throw new Error(message);\r\n\r\n      // Ignore errors thrown by styled-components. This can be removed once we upgrade\r\n      // to styled-components@6 and have separate props that are rendered in the DOM by\r\n      // the ones that aren't using the $ prefix.\r\n      // https://styled-components.com/docs/faqs#transient-as-and-forwardedas-props-have-been-dropped\r\n    } else if (\r\n      /React does not recognize the .* prop on a DOM element/.test(message) ||\r\n      /Unknown event handler property/.test(message)\r\n    ) {\r\n      // do nothing\r\n    } else if (/Support for defaultProps will be removed/gi.test(message)) {\r\n      // do nothing\r\n    } else {\r\n      throw new Error(message);\r\n    }\r\n  },\r\n};\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * Strapi\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\nwindow.strapi = {\r\n  backendURL: 'http://localhost:1337',\r\n  isEE: false,\r\n  features: {\r\n    SSO: 'sso',\r\n    isEnabled: () => false,\r\n  },\r\n  future: {\r\n    isEnabled: () => false,\r\n  },\r\n  projectType: 'Community',\r\n  telemetryDisabled: true,\r\n  flags: {\r\n    nps: true,\r\n    promoteEE: true,\r\n  },\r\n};\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * matchMedia\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\nObject.defineProperty(window, 'matchMedia', {\r\n  writable: true,\r\n  value: jest.fn().mockImplementation((query) => ({\r\n    matches: false,\r\n    media: query,\r\n    onchange: null,\r\n    /**\r\n     * @deprecated\r\n     */\r\n    addListener: jest.fn(),\r\n    /**\r\n     * @deprecated\r\n     */\r\n    removeListener: jest.fn(),\r\n    addEventListener: jest.fn(),\r\n    removeEventListener: jest.fn(),\r\n    dispatchEvent: jest.fn(),\r\n  })),\r\n});\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * scrollTo\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\nObject.defineProperty(window, 'scrollTo', {\r\n  writable: true,\r\n  value: jest.fn(),\r\n});\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * prompt\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\nObject.defineProperty(window, 'prompt', {\r\n  writable: true,\r\n  value: jest.fn(),\r\n});\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * URL\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\nwindow.URL.createObjectURL = jest\r\n  .fn()\r\n  .mockImplementation((file) => `http://localhost:4000/assets/${file.name}`);\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * createRange\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\ndocument.createRange = () => {\r\n  const range = new Range();\r\n  // @ts-expect-error we don't need to implement all the methods\r\n  range.getClientRects = jest.fn(() => ({\r\n    item: () => null,\r\n    length: 0,\r\n  }));\r\n\r\n  return range;\r\n};\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * localStorage\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\nclass LocalStorageMock {\r\n  store: Map<string, string>;\r\n\r\n  constructor() {\r\n    this.store = new Map();\r\n  }\r\n\r\n  clear() {\r\n    this.store.clear();\r\n  }\r\n\r\n  getItem(key: string) {\r\n    /**\r\n     * We return null to avoid returning `undefined`\r\n     * because `undefined` is not a valid JSON value.\r\n     */\r\n    return this.store.get(key) ?? null;\r\n  }\r\n\r\n  setItem(key: string, value: unknown) {\r\n    this.store.set(key, String(value));\r\n  }\r\n\r\n  removeItem(key: string) {\r\n    this.store.delete(key);\r\n  }\r\n\r\n  get length() {\r\n    return this.store.size;\r\n  }\r\n}\r\n\r\nObject.defineProperty(window, 'localStorage', {\r\n  writable: true,\r\n  value: new LocalStorageMock(),\r\n});\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * PointerEvents\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\n/**\r\n * JSDOM doesn't implement PointerEvent so we need to mock our own implementation\r\n * Default to mouse left click interaction\r\n * https://github.com/radix-ui/primitives/issues/1822\r\n * https://github.com/jsdom/jsdom/pull/2666\r\n */\r\nclass MockPointerEvent extends Event {\r\n  button: number;\r\n\r\n  ctrlKey: boolean;\r\n\r\n  pointerType: string;\r\n\r\n  constructor(\r\n    type: string,\r\n    props: EventInit & { button?: number; ctrlKey?: boolean; pointerType?: string }\r\n  ) {\r\n    super(type, props);\r\n    this.button = props.button || 0;\r\n    this.ctrlKey = props.ctrlKey || false;\r\n    this.pointerType = props.pointerType || 'mouse';\r\n  }\r\n}\r\n\r\nObject.defineProperty(window, 'PointerEvent', {\r\n  writable: true,\r\n  value: MockPointerEvent,\r\n});\r\n\r\nwindow.HTMLElement.prototype.scrollIntoView = jest.fn();\r\nwindow.HTMLElement.prototype.releasePointerCapture = jest.fn();\r\nwindow.HTMLElement.prototype.hasPointerCapture = jest.fn();\r\n\r\n/* -------------------------------------------------------------------------------------------------\r\n * Navigator\r\n * -----------------------------------------------------------------------------------------------*/\r\n\r\n/**\r\n * Navigator is a large object so we only mock the properties we need.\r\n */\r\nObject.assign(navigator, {\r\n  clipboard: {\r\n    writeText: jest.fn(),\r\n  },\r\n});\r\n"],"names":["ResizeObserver","format"],"mappings":"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"}