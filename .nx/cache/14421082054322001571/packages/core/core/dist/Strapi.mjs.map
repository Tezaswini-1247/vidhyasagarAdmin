{"version":3,"file":"Strapi.mjs","sources":["../src/Strapi.ts"],"sourcesContent":["import * as globalAgent from 'global-agent';\r\nimport path from 'path';\r\nimport _ from 'lodash';\r\nimport { isFunction } from 'lodash/fp';\r\nimport { Logger, createLogger } from '@strapi/logger';\r\nimport { Database } from '@strapi/database';\r\n\r\nimport type { Core, Modules, UID, Schema } from '@strapi/types';\r\n\r\nimport tsUtils from '@strapi/typescript-utils';\r\nimport { loadConfiguration } from './configuration';\r\n\r\nimport * as factories from './factories';\r\n\r\nimport * as utils from './utils';\r\nimport { Container } from './container';\r\nimport createStrapiFs from './services/fs';\r\nimport createEventHub from './services/event-hub';\r\nimport { createServer } from './services/server';\r\nimport { createReloader } from './services/reloader';\r\n\r\nimport { providers } from './providers';\r\nimport createEntityService from './services/entity-service';\r\nimport createQueryParamService from './services/query-params';\r\n\r\nimport entityValidator from './services/entity-validator';\r\nimport requestContext from './services/request-context';\r\nimport createAuth from './services/auth';\r\nimport createCustomFields from './services/custom-fields';\r\nimport createContentAPI from './services/content-api';\r\nimport getNumberOfDynamicZones from './services/utils/dynamic-zones';\r\nimport { FeaturesService, createFeaturesService } from './services/features';\r\nimport { createDocumentService } from './services/document-service';\r\n\r\nimport { coreStoreModel } from './services/core-store';\r\nimport { createConfigProvider } from './services/config';\r\n\r\nclass Strapi extends Container implements Core.Strapi {\r\n  app: any;\r\n\r\n  isLoaded: boolean = false;\r\n\r\n  internal_config: Record<string, unknown> = {};\r\n\r\n  constructor(opts: StrapiOptions) {\r\n    super();\r\n\r\n    this.internal_config = loadConfiguration(opts);\r\n\r\n    this.registerInternalServices();\r\n\r\n    for (const provider of providers) {\r\n      provider.init?.(this);\r\n    }\r\n  }\r\n\r\n  get admin(): Core.Module {\r\n    return this.get('admin');\r\n  }\r\n\r\n  get EE(): boolean {\r\n    return utils.ee.isEE;\r\n  }\r\n\r\n  get ee(): Core.Strapi['ee'] {\r\n    return utils.ee;\r\n  }\r\n\r\n  get dirs(): Core.StrapiDirectories {\r\n    return this.config.get('dirs');\r\n  }\r\n\r\n  get reload(): Core.Reloader {\r\n    return this.get('reload');\r\n  }\r\n\r\n  get db(): Database {\r\n    return this.get('db');\r\n  }\r\n\r\n  get requestContext(): Modules.RequestContext.RequestContext {\r\n    return this.get('requestContext');\r\n  }\r\n\r\n  get customFields(): Modules.CustomFields.CustomFields {\r\n    return this.get('customFields');\r\n  }\r\n\r\n  get entityValidator(): Modules.EntityValidator.EntityValidator {\r\n    return this.get('entityValidator');\r\n  }\r\n\r\n  /**\r\n   * @deprecated `strapi.entityService` will be removed in the next major version\r\n   */\r\n  get entityService(): Modules.EntityService.EntityService {\r\n    return this.get('entityService');\r\n  }\r\n\r\n  get documents(): Modules.Documents.Service {\r\n    return this.get('documents');\r\n  }\r\n\r\n  get features(): FeaturesService {\r\n    return this.get('features');\r\n  }\r\n\r\n  get fetch(): Modules.Fetch.Fetch {\r\n    return this.get('fetch');\r\n  }\r\n\r\n  get cron(): Modules.Cron.CronService {\r\n    return this.get('cron');\r\n  }\r\n\r\n  get log(): Logger {\r\n    return this.get('logger');\r\n  }\r\n\r\n  get startupLogger(): Core.StartupLogger {\r\n    return this.get('startupLogger');\r\n  }\r\n\r\n  get eventHub(): Modules.EventHub.EventHub {\r\n    return this.get('eventHub');\r\n  }\r\n\r\n  get fs(): Core.StrapiFS {\r\n    return this.get('fs');\r\n  }\r\n\r\n  get server(): Modules.Server.Server {\r\n    return this.get('server');\r\n  }\r\n\r\n  get telemetry(): Modules.Metrics.TelemetryService {\r\n    return this.get('telemetry');\r\n  }\r\n\r\n  get store(): Modules.CoreStore.CoreStore {\r\n    return this.get('coreStore');\r\n  }\r\n\r\n  get config() {\r\n    return this.get('config');\r\n  }\r\n\r\n  get services() {\r\n    return this.get('services').getAll();\r\n  }\r\n\r\n  service(uid: UID.Service) {\r\n    return this.get('services').get(uid);\r\n  }\r\n\r\n  get controllers() {\r\n    return this.get('controllers').getAll();\r\n  }\r\n\r\n  controller(uid: UID.Controller) {\r\n    return this.get('controllers').get(uid);\r\n  }\r\n\r\n  get contentTypes(): Schema.ContentTypes {\r\n    return this.get('content-types').getAll();\r\n  }\r\n\r\n  contentType(name: UID.ContentType) {\r\n    return this.get('content-types').get(name);\r\n  }\r\n\r\n  get components(): Schema.Components {\r\n    return this.get('components').getAll();\r\n  }\r\n\r\n  get policies() {\r\n    return this.get('policies').getAll();\r\n  }\r\n\r\n  policy(name: string) {\r\n    return this.get('policies').get(name);\r\n  }\r\n\r\n  get middlewares() {\r\n    return this.get('middlewares').getAll();\r\n  }\r\n\r\n  middleware(name: string) {\r\n    return this.get('middlewares').get(name);\r\n  }\r\n\r\n  get plugins(): Record<string, Core.Plugin> {\r\n    return this.get('plugins').getAll();\r\n  }\r\n\r\n  plugin(name: string): Core.Plugin {\r\n    return this.get('plugins').get(name);\r\n  }\r\n\r\n  get hooks() {\r\n    return this.get('hooks').getAll();\r\n  }\r\n\r\n  hook(name: string) {\r\n    return this.get('hooks').get(name);\r\n  }\r\n\r\n  get apis() {\r\n    return this.get('apis').getAll();\r\n  }\r\n\r\n  api(name: string): Core.Module {\r\n    return this.get('apis').get(name);\r\n  }\r\n\r\n  get auth() {\r\n    return this.get('auth');\r\n  }\r\n\r\n  get contentAPI() {\r\n    return this.get('content-api');\r\n  }\r\n\r\n  get sanitizers() {\r\n    return this.get('sanitizers');\r\n  }\r\n\r\n  get validators() {\r\n    return this.get('validators');\r\n  }\r\n\r\n  async start() {\r\n    try {\r\n      if (!this.isLoaded) {\r\n        await this.load();\r\n      }\r\n\r\n      await this.listen();\r\n\r\n      return this;\r\n    } catch (error) {\r\n      return this.stopWithError(error);\r\n    }\r\n  }\r\n\r\n  // TODO: split into more providers\r\n  registerInternalServices() {\r\n    const config = createConfigProvider(this.internal_config, this);\r\n\r\n    const logger = createLogger({\r\n      level: 'http', // Strapi defaults to level 'http'\r\n      ...config.get('logger'), // DEPRECATED\r\n      ...config.get('server.logger.config'),\r\n    });\r\n\r\n    // Instantiate the Strapi container\r\n    this.add('config', () => config)\r\n      .add('query-params', createQueryParamService(this))\r\n      .add('content-api', createContentAPI(this))\r\n      .add('auth', createAuth())\r\n      .add('server', () => createServer(this))\r\n      .add('fs', () => createStrapiFs(this))\r\n      .add('eventHub', () => createEventHub())\r\n      .add('startupLogger', () => utils.createStartupLogger(this))\r\n      .add('logger', () => logger)\r\n      .add('fetch', () => utils.createStrapiFetch(this))\r\n      .add('features', () => createFeaturesService(this))\r\n      .add('requestContext', requestContext)\r\n      .add('customFields', createCustomFields(this))\r\n      .add('entityValidator', entityValidator)\r\n      .add('entityService', () => createEntityService({ strapi: this, db: this.db }))\r\n      .add('documents', () => createDocumentService(this))\r\n      .add('db', () => {\r\n        const tsDir = tsUtils.resolveOutDirSync(this.dirs.app.root);\r\n        const tsMigrationsEnabled =\r\n          this.config.get('database.settings.useTypescriptMigrations') === true && tsDir;\r\n        const projectDir = tsMigrationsEnabled ? tsDir : this.dirs.app.root;\r\n        return new Database(\r\n          _.merge(this.config.get('database'), {\r\n            logger,\r\n            settings: {\r\n              migrations: {\r\n                dir: path.join(projectDir, 'database/migrations'),\r\n              },\r\n            },\r\n          })\r\n        );\r\n      })\r\n      .add('reload', () => createReloader(this));\r\n  }\r\n\r\n  sendStartupTelemetry() {\r\n    // Emit started event.\r\n    // do not await to avoid slower startup\r\n    // This event is anonymous\r\n    this.telemetry\r\n      .send('didStartServer', {\r\n        groupProperties: {\r\n          database: this.config.get('database.connection.client'),\r\n          plugins: Object.keys(this.plugins),\r\n          numberOfAllContentTypes: _.size(this.contentTypes), // TODO: V5: This event should be renamed numberOfContentTypes in V5 as the name is already taken to describe the number of content types using i18n.\r\n          numberOfComponents: _.size(this.components),\r\n          numberOfDynamicZones: getNumberOfDynamicZones(),\r\n          numberOfCustomControllers: Object.values<Core.Controller>(this.controllers).filter(\r\n            // TODO: Fix this at the content API loader level to prevent future types issues\r\n            (controller) => controller !== undefined && factories.isCustomController(controller)\r\n          ).length,\r\n          environment: this.config.environment,\r\n          // TODO: to add back\r\n          // providers: this.config.installedProviders,\r\n        },\r\n      })\r\n      .catch(this.log.error);\r\n  }\r\n\r\n  async openAdmin({ isInitialized }: { isInitialized: boolean }) {\r\n    const shouldOpenAdmin =\r\n      this.config.get('environment') === 'development' &&\r\n      this.config.get('admin.autoOpen', true) !== false;\r\n\r\n    if (shouldOpenAdmin && !isInitialized) {\r\n      try {\r\n        await utils.openBrowser(this.config);\r\n        this.telemetry.send('didOpenTab');\r\n      } catch (e) {\r\n        this.telemetry.send('didNotOpenTab');\r\n      }\r\n    }\r\n  }\r\n\r\n  async postListen() {\r\n    const isInitialized = await utils.isInitialized(this);\r\n\r\n    this.startupLogger.logStartupMessage({ isInitialized });\r\n\r\n    this.log.info('started successfully');\r\n    this.sendStartupTelemetry();\r\n    this.openAdmin({ isInitialized });\r\n  }\r\n\r\n  /**\r\n   * Add behaviors to the server\r\n   */\r\n  async listen() {\r\n    return new Promise<void>((resolve, reject) => {\r\n      const onListen = async () => {\r\n        try {\r\n          await this.postListen();\r\n\r\n          resolve();\r\n        } catch (error) {\r\n          reject(error);\r\n        }\r\n      };\r\n\r\n      const listenSocket = this.config.get('server.socket');\r\n\r\n      if (listenSocket) {\r\n        this.server.listen(listenSocket, onListen);\r\n      } else {\r\n        const { host, port } = this.config.get('server');\r\n\r\n        this.server.listen(port, host, onListen);\r\n      }\r\n    });\r\n  }\r\n\r\n  stopWithError(err: unknown, customMessage?: string): never {\r\n    this.log.debug(`⛔️ Server wasn't able to start properly.`);\r\n    if (customMessage) {\r\n      this.log.error(customMessage);\r\n    }\r\n\r\n    this.log.error(err);\r\n    return this.stop();\r\n  }\r\n\r\n  stop(exitCode = 1): never {\r\n    this.destroy();\r\n\r\n    if (this.config.get('autoReload')) {\r\n      process.send?.('stop');\r\n    }\r\n\r\n    // Kill process\r\n    process.exit(exitCode);\r\n  }\r\n\r\n  async load() {\r\n    await this.register();\r\n    await this.bootstrap();\r\n\r\n    this.isLoaded = true;\r\n\r\n    return this;\r\n  }\r\n\r\n  async register() {\r\n    // @ts-expect-error: init is internal\r\n    this.ee.init(this.dirs.app.root, this.log);\r\n\r\n    for (const provider of providers) {\r\n      await provider.register?.(this);\r\n    }\r\n\r\n    await this.runPluginsLifecycles(utils.LIFECYCLES.REGISTER);\r\n    await this.runUserLifecycles(utils.LIFECYCLES.REGISTER);\r\n\r\n    // NOTE: Swap type customField for underlying data type\r\n    utils.convertCustomFieldType(this);\r\n\r\n    return this;\r\n  }\r\n\r\n  async bootstrap() {\r\n    this.configureGlobalProxy();\r\n\r\n    const models = [\r\n      ...utils.transformContentTypesToModels(\r\n        [...Object.values(this.contentTypes), ...Object.values(this.components)],\r\n        this.db.metadata.identifiers\r\n      ),\r\n      ...this.get('models').get(),\r\n    ];\r\n\r\n    await this.db.init({ models });\r\n\r\n    let oldContentTypes;\r\n    if (await this.db.getSchemaConnection().hasTable(coreStoreModel.tableName)) {\r\n      oldContentTypes = await this.store.get({\r\n        type: 'strapi',\r\n        name: 'content_types',\r\n        key: 'schema',\r\n      });\r\n    }\r\n\r\n    await this.hook('strapi::content-types.beforeSync').call({\r\n      oldContentTypes,\r\n      contentTypes: this.contentTypes,\r\n    });\r\n\r\n    await this.db.schema.sync();\r\n\r\n    if (this.EE) {\r\n      await utils.ee.checkLicense({ strapi: this });\r\n    }\r\n\r\n    await this.hook('strapi::content-types.afterSync').call({\r\n      oldContentTypes,\r\n      contentTypes: this.contentTypes,\r\n    });\r\n\r\n    await this.store.set({\r\n      type: 'strapi',\r\n      name: 'content_types',\r\n      key: 'schema',\r\n      value: this.contentTypes,\r\n    });\r\n\r\n    await this.server.initMiddlewares();\r\n    this.server.initRouting();\r\n\r\n    await this.contentAPI.permissions.registerActions();\r\n\r\n    await this.runPluginsLifecycles(utils.LIFECYCLES.BOOTSTRAP);\r\n\r\n    for (const provider of providers) {\r\n      await provider.bootstrap?.(this);\r\n    }\r\n\r\n    await this.runUserLifecycles(utils.LIFECYCLES.BOOTSTRAP);\r\n\r\n    return this;\r\n  }\r\n\r\n  configureGlobalProxy() {\r\n    const globalProxy = this.config.get('server.proxy.global');\r\n    const httpProxy = this.config.get('server.proxy.http') || globalProxy;\r\n    const httpsProxy = this.config.get('server.proxy.https') || globalProxy;\r\n\r\n    if (!httpProxy && !httpsProxy) {\r\n      return;\r\n    }\r\n\r\n    globalAgent.bootstrap();\r\n\r\n    if (httpProxy) {\r\n      this.log.info(`Using HTTP proxy: ${httpProxy}`);\r\n      (global as any).GLOBAL_AGENT.HTTP_PROXY = httpProxy;\r\n    }\r\n\r\n    if (httpsProxy) {\r\n      this.log.info(`Using HTTPS proxy: ${httpsProxy}`);\r\n      (global as any).GLOBAL_AGENT.HTTPS_PROXY = httpsProxy;\r\n    }\r\n  }\r\n\r\n  async destroy() {\r\n    this.log.info('Shutting down');\r\n    await this.runPluginsLifecycles(utils.LIFECYCLES.DESTROY);\r\n\r\n    for (const provider of providers) {\r\n      await provider.destroy?.(this);\r\n    }\r\n\r\n    await this.runUserLifecycles(utils.LIFECYCLES.DESTROY);\r\n\r\n    await this.server.destroy();\r\n\r\n    this.eventHub.destroy();\r\n\r\n    await this.db?.destroy();\r\n\r\n    process.removeAllListeners();\r\n\r\n    // @ts-expect-error: Allow clean delete of global.strapi to allow re-instanciation\r\n    delete global.strapi;\r\n\r\n    this.log.info('poratl has been shut down');\r\n  }\r\n\r\n  async runPluginsLifecycles(lifecycleName: 'register' | 'bootstrap' | 'destroy') {\r\n    // plugins\r\n    await this.get('modules')[lifecycleName]();\r\n  }\r\n\r\n  async runUserLifecycles(lifecycleName: 'register' | 'bootstrap' | 'destroy') {\r\n    // user\r\n    const userLifecycleFunction = this.app && this.app[lifecycleName];\r\n    if (isFunction(userLifecycleFunction)) {\r\n      await userLifecycleFunction({ strapi: this });\r\n    }\r\n  }\r\n\r\n  getModel(uid: UID.ContentType): Schema.ContentType;\r\n  getModel(uid: UID.Component): Schema.Component;\r\n  getModel<TUID extends UID.Schema>(uid: TUID): Schema.ContentType | Schema.Component | undefined {\r\n    if (uid in this.contentTypes) {\r\n      return this.contentTypes[uid as UID.ContentType];\r\n    }\r\n\r\n    if (uid in this.components) {\r\n      return this.components[uid as UID.Component];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @deprecated Use `strapi.db.query` instead\r\n   */\r\n  query(uid: UID.Schema) {\r\n    return this.db.query(uid);\r\n  }\r\n}\r\n\r\nexport interface StrapiOptions {\r\n  appDir: string;\r\n  distDir: string;\r\n  autoReload?: boolean;\r\n  serveAdminPanel?: boolean;\r\n}\r\n\r\nexport default Strapi;\r\n"],"names":["utils.ee","createAuth","utils.createStartupLogger","utils.createStrapiFetch","requestContext","factories.isCustomController","isInitialized","utils.openBrowser","utils.isInitialized","utils.LIFECYCLES","utils.convertCustomFieldType","utils.transformContentTypesToModels"],"mappings":"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"}